# ğŸš€ éƒ¨ç½²è„šæœ¬è¯´æ˜

## ğŸ“ ç›®å½•ç»“æ„

```
deploy/
â”œâ”€â”€ bin/                    # éƒ¨ç½²è„šæœ¬ç›®å½•
â”‚   â”œâ”€â”€ docker/            # Docker ç›¸å…³è„šæœ¬
â”‚   â”‚   â”œâ”€â”€ build.sh       # Docker é•œåƒæ„å»º
â”‚   â”‚   â”œâ”€â”€ run.sh         # Docker å®¹å™¨è¿è¡Œ
â”‚   â”‚   â”œâ”€â”€ stop.sh        # Docker å®¹å™¨åœæ­¢
â”‚   â”‚   â””â”€â”€ remove.sh      # Docker å®¹å™¨åˆ é™¤
â”‚   â””â”€â”€ helm/              # Helm ç›¸å…³è„šæœ¬
â”‚       â”œâ”€â”€ install.sh     # Helm å®‰è£…
â”‚       â”œâ”€â”€ uninstall.sh   # Helm å¸è½½
â”‚       â””â”€â”€ logs.sh        # Helm æ—¥å¿—æŸ¥çœ‹
â”œâ”€â”€ deploy/                # åº”ç”¨éƒ¨ç½²è„šæœ¬
â”‚   â”œâ”€â”€ startup.sh         # åº”ç”¨å¯åŠ¨è„šæœ¬
â”‚   â”œâ”€â”€ shutdown.sh        # åº”ç”¨åœæ­¢è„šæœ¬
â”‚   â”œâ”€â”€ restart.sh         # åº”ç”¨é‡å¯è„šæœ¬
â”‚   â””â”€â”€ debugger.sh        # åº”ç”¨è°ƒè¯•è„šæœ¬
â”œâ”€â”€ docker/                # Docker é…ç½®æ–‡ä»¶
â”‚   â””â”€â”€ Dockerfile-boot    # åç«¯åº”ç”¨ Dockerfile
â””â”€â”€ helm-chart/            # Helm å›¾è¡¨
    â”œâ”€â”€ Chart.yaml         # Helm å›¾è¡¨å®šä¹‰
    â”œâ”€â”€ values.yaml        # Helm é…ç½®å€¼
    â”œâ”€â”€ templates/         # Helm æ¨¡æ¿æ–‡ä»¶
    â””â”€â”€ README.md          # Helm è¯´æ˜æ–‡æ¡£
```

## ğŸ³ Docker éƒ¨ç½²è„šæœ¬

### build.sh - é•œåƒæ„å»º

**åŠŸèƒ½**: æ„å»º Docker é•œåƒ

**ç”¨æ³•**:
```bash
sh build.sh <ä»“åº“å> <é•œåƒå> <æ ‡ç­¾> [ç¯å¢ƒ]
```

**å‚æ•°è¯´æ˜**:
- `ä»“åº“å`: Docker é•œåƒä»“åº“åç§°
- `é•œåƒå`: Docker é•œåƒåç§°
- `æ ‡ç­¾`: Docker é•œåƒæ ‡ç­¾
- `ç¯å¢ƒ`: æ„å»ºç¯å¢ƒ (local|dev|test|prod)ï¼Œé»˜è®¤ä¸º local

**ç¤ºä¾‹**:
```bash
# æ„å»ºå¼€å‘ç¯å¢ƒé•œåƒ
sh build.sh myregistry mingsha-template-vue v1.0.0 dev

# æ„å»ºç”Ÿäº§ç¯å¢ƒé•œåƒ
sh build.sh myregistry mingsha-template-vue v1.0.0 prod
```

**ç‰¹æ€§**:
- æ”¯æŒå¤šå¹³å°æ„å»º (linux/amd64)
- è‡ªåŠ¨æ¸…ç†æ„å»ºç¼“å­˜
- æ„å»ºå¤±è´¥æ—¶è‡ªåŠ¨é€€å‡º

### run.sh - å®¹å™¨è¿è¡Œ

**åŠŸèƒ½**: è¿è¡Œ Docker å®¹å™¨

**ç”¨æ³•**:
```bash
sh run.sh <é•œåƒå> <å®¹å™¨å> [ç«¯å£æ˜ å°„] [ç¯å¢ƒå˜é‡]
```

**ç¤ºä¾‹**:
```bash
# è¿è¡Œå®¹å™¨
sh run.sh mingsha-template-vue:latest mingsha-app 8001:8001

# è¿è¡Œå®¹å™¨å¹¶è®¾ç½®ç¯å¢ƒå˜é‡
sh run.sh mingsha-template-vue:latest mingsha-app 8001:8001 "SPRING_PROFILES_ACTIVE=prod"
```

**ç‰¹æ€§**:
- è‡ªåŠ¨ç«¯å£æ˜ å°„
- æ”¯æŒç¯å¢ƒå˜é‡é…ç½®
- å®¹å™¨åç§°è‡ªåŠ¨ç”Ÿæˆ
- åå°è¿è¡Œæ¨¡å¼

### stop.sh - å®¹å™¨åœæ­¢

**åŠŸèƒ½**: åœæ­¢ Docker å®¹å™¨

**ç”¨æ³•**:
```bash
sh stop.sh <å®¹å™¨å>
```

**ç¤ºä¾‹**:
```bash
# åœæ­¢å®¹å™¨
sh stop.sh mingsha-app
```

**ç‰¹æ€§**:
- ä¼˜é›…åœæ­¢å®¹å™¨
- è‡ªåŠ¨æ¸…ç†ç›¸å…³èµ„æº
- æ”¯æŒæ‰¹é‡åœæ­¢

### remove.sh - å®¹å™¨åˆ é™¤

**åŠŸèƒ½**: åˆ é™¤ Docker å®¹å™¨å’Œé•œåƒ

**ç”¨æ³•**:
```bash
sh remove.sh <å®¹å™¨å> [é•œåƒå]
```

**ç¤ºä¾‹**:
```bash
# åˆ é™¤å®¹å™¨
sh remove.sh mingsha-app

# åˆ é™¤å®¹å™¨å’Œé•œåƒ
sh remove.sh mingsha-app mingsha-template-vue:latest
```

**ç‰¹æ€§**:
- å¼ºåˆ¶åˆ é™¤å®¹å™¨
- å¯é€‰åˆ é™¤é•œåƒ
- æ¸…ç†ç›¸å…³èµ„æº

## â˜¸ï¸ Helm éƒ¨ç½²è„šæœ¬

### install.sh - Helm å®‰è£…

**åŠŸèƒ½**: ä½¿ç”¨ Helm å®‰è£…åº”ç”¨åˆ° Kubernetes

**ç”¨æ³•**:
```bash
sh install.sh <å‘å¸ƒå> [å‘½åç©ºé—´] [é…ç½®æ–‡ä»¶]
```

**å‚æ•°è¯´æ˜**:
- `å‘å¸ƒå`: Helm å‘å¸ƒåç§°
- `å‘½åç©ºé—´`: Kubernetes å‘½åç©ºé—´ï¼Œé»˜è®¤ä¸º default
- `é…ç½®æ–‡ä»¶`: è‡ªå®šä¹‰ values æ–‡ä»¶è·¯å¾„

**ç¤ºä¾‹**:
```bash
# å®‰è£…åˆ°é»˜è®¤å‘½åç©ºé—´
sh install.sh mingsha-template-vue

# å®‰è£…åˆ°æŒ‡å®šå‘½åç©ºé—´
sh install.sh mingsha-template-vue mingsha

# ä½¿ç”¨è‡ªå®šä¹‰é…ç½®
sh install.sh mingsha-template-vue mingsha values-prod.yaml
```

**ç‰¹æ€§**:
- è‡ªåŠ¨åˆ›å»ºå‘½åç©ºé—´
- æ”¯æŒè‡ªå®šä¹‰é…ç½®
- å®‰è£…å‰æ£€æŸ¥ä¾èµ–

### uninstall.sh - Helm å¸è½½

**åŠŸèƒ½**: å¸è½½ Helm åº”ç”¨

**ç”¨æ³•**:
```bash
sh uninstall.sh <å‘å¸ƒå> [å‘½åç©ºé—´]
```

**ç¤ºä¾‹**:
```bash
# å¸è½½åº”ç”¨
sh uninstall.sh mingsha-template-vue

# ä»æŒ‡å®šå‘½åç©ºé—´å¸è½½
sh uninstall.sh mingsha-template-vue mingsha
```

**ç‰¹æ€§**:
- å®Œå…¨æ¸…ç†èµ„æº
- ä¿ç•™ PVC æ•°æ®
- æ”¯æŒå‘½åç©ºé—´æ¸…ç†

### logs.sh - æ—¥å¿—æŸ¥çœ‹

**åŠŸèƒ½**: æŸ¥çœ‹åº”ç”¨æ—¥å¿—

**ç”¨æ³•**:
```bash
sh logs.sh <å‘å¸ƒå> [å‘½åç©ºé—´] [å®¹å™¨å]
```

**ç¤ºä¾‹**:
```bash
# æŸ¥çœ‹åº”ç”¨æ—¥å¿—
sh logs.sh mingsha-template-vue

# æŸ¥çœ‹æŒ‡å®šå®¹å™¨æ—¥å¿—
sh logs.sh mingsha-template-vue mingsha mingsha-template-vue
```

**ç‰¹æ€§**:
- å®æ—¶æ—¥å¿—æµ
- æ”¯æŒå¤šå®¹å™¨
- æ—¥å¿—è¿‡æ»¤åŠŸèƒ½

## ğŸš€ åº”ç”¨éƒ¨ç½²è„šæœ¬

### startup.sh - åº”ç”¨å¯åŠ¨

**åŠŸèƒ½**: å¯åŠ¨ Spring Boot åº”ç”¨

**ç”¨æ³•**:
```bash
sh startup.sh [é…ç½®æ–‡ä»¶è·¯å¾„]
```

**ç‰¹æ€§**:
- è‡ªåŠ¨åˆ›å»ºå¿…è¦ç›®å½•
- JVM å‚æ•°ä¼˜åŒ–
- æ—¥å¿—ç®¡ç†
- è¿›ç¨‹ç›‘æ§
- ä¼˜é›…å¯åŠ¨

**ç›®å½•ç»“æ„**:
```
åº”ç”¨æ ¹ç›®å½•/
â”œâ”€â”€ boot/                   # å¯åŠ¨ jar åŒ…
â”œâ”€â”€ conf/                   # é…ç½®æ–‡ä»¶
â”œâ”€â”€ lib/                    # ä¾èµ– jar åŒ…
â”œâ”€â”€ logs/                   # è¿è¡Œæ—¥å¿—
â”‚   â”œâ”€â”€ startup.log        # å¯åŠ¨æ—¥å¿—
â”‚   â””â”€â”€ back/              # æ—¥å¿—å¤‡ä»½
â”œâ”€â”€ gc/                     # GC æ—¥å¿—
â””â”€â”€ dump/                   # å†…å­˜è½¬å‚¨
```

**JVM é…ç½®**:
```bash
# JVM å‚æ•°ä» conf/jvm.options æ–‡ä»¶è¯»å–
JAVA_OPT=$(for i in `cat ${BASE_PATH}/conf/jvm.options|grep -v "^#"|grep -v ^$`;do echo " $i";done)
```

### shutdown.sh - åº”ç”¨åœæ­¢

**åŠŸèƒ½**: åœæ­¢ Spring Boot åº”ç”¨

**ç”¨æ³•**:
```bash
sh shutdown.sh [è¿›ç¨‹å]
```

**ç‰¹æ€§**:
- ä¼˜é›…åœæ­¢åº”ç”¨
- è‡ªåŠ¨æ¸…ç†è¿›ç¨‹
- æ—¥å¿—è®°å½•

### restart.sh - åº”ç”¨é‡å¯

**åŠŸèƒ½**: é‡å¯ Spring Boot åº”ç”¨

**ç”¨æ³•**:
```bash
sh restart.sh [é…ç½®æ–‡ä»¶è·¯å¾„]
```

**ç‰¹æ€§**:
- å…ˆåœæ­¢å†å¯åŠ¨
- ä¿æŒé…ç½®ä¸€è‡´æ€§
- çŠ¶æ€æ£€æŸ¥

### debugger.sh - åº”ç”¨è°ƒè¯•

**åŠŸèƒ½**: ä»¥è°ƒè¯•æ¨¡å¼å¯åŠ¨åº”ç”¨

**ç”¨æ³•**:
```bash
sh debugger.sh [è°ƒè¯•ç«¯å£]
```

**ç‰¹æ€§**:
- è¿œç¨‹è°ƒè¯•æ”¯æŒ
- æ–­ç‚¹è°ƒè¯•
- å†…å­˜ç›‘æ§
- æ€§èƒ½åˆ†æ

## ğŸ³ Docker é…ç½®

### Dockerfile-boot

**åŠŸèƒ½**: åç«¯åº”ç”¨ Docker é•œåƒæ„å»ºæ–‡ä»¶

**ç‰¹æ€§**:
- å¤šé˜¶æ®µæ„å»º
- æœ€å°åŒ–é•œåƒå¤§å°
- å®‰å…¨æœ€ä½³å®è·µ
- å¥åº·æ£€æŸ¥

**æ„å»ºå‘½ä»¤**:
```bash
docker build -f deploy/docker/Dockerfile-boot -t mingsha-template-vue:latest .
```

## â˜¸ï¸ Helm å›¾è¡¨

### Chart.yaml

**åŠŸèƒ½**: Helm å›¾è¡¨å®šä¹‰æ–‡ä»¶

**é…ç½®é¡¹**:
- `name`: å›¾è¡¨åç§°
- `version`: å›¾è¡¨ç‰ˆæœ¬
- `appVersion`: åº”ç”¨ç‰ˆæœ¬
- `description`: å›¾è¡¨æè¿°
- `maintainers`: ç»´æŠ¤è€…ä¿¡æ¯

### values.yaml

**åŠŸèƒ½**: Helm é…ç½®å€¼æ–‡ä»¶

**ä¸»è¦é…ç½®**:
- é•œåƒé…ç½®
- èµ„æºé™åˆ¶
- ç¯å¢ƒå˜é‡
- æœåŠ¡é…ç½®
- æŒä¹…åŒ–å­˜å‚¨

**ç¤ºä¾‹é…ç½®**:
```yaml
image:
  repository: mingsha-template-vue
  tag: latest
  pullPolicy: IfNotPresent

resources:
  limits:
    cpu: 1000m
    memory: 1Gi
  requests:
    cpu: 500m
    memory: 512Mi

env:
  - name: SPRING_PROFILES_ACTIVE
    value: "prod"
  - name: DB_HOST
    value: "mysql-service"
```

## ğŸ“‹ ä½¿ç”¨ç¤ºä¾‹

### å®Œæ•´éƒ¨ç½²æµç¨‹

```bash
# 1. æ„å»º Docker é•œåƒ
sh deploy/bin/docker/build.sh myregistry mingsha-template-vue v1.0.0 prod

# 2. æ¨é€é•œåƒåˆ°ä»“åº“
docker push myregistry/mingsha-template-vue-prod:v1.0.0

# 3. ä½¿ç”¨ Helm éƒ¨ç½²åˆ° Kubernetes
sh deploy/bin/helm/install.sh mingsha-template-vue mingsha

# 4. æŸ¥çœ‹éƒ¨ç½²çŠ¶æ€
kubectl get pods -n mingsha

# 5. æŸ¥çœ‹åº”ç”¨æ—¥å¿—
sh deploy/bin/helm/logs.sh mingsha-template-vue mingsha
```

### æœ¬åœ°å¼€å‘éƒ¨ç½²

```bash
# 1. æ„å»ºæœ¬åœ°é•œåƒ
sh deploy/bin/docker/build.sh local mingsha-template-vue dev

# 2. è¿è¡Œå®¹å™¨
sh deploy/bin/docker/run.sh local/mingsha-template-vue-dev:latest mingsha-dev 8001:8001

# 3. æŸ¥çœ‹å®¹å™¨çŠ¶æ€
docker ps | grep mingsha-dev
```

### ç”Ÿäº§ç¯å¢ƒéƒ¨ç½²

```bash
# 1. æ„å»ºç”Ÿäº§é•œåƒ
sh deploy/bin/docker/build.sh prod-registry mingsha-template-vue v1.0.0 prod

# 2. ä½¿ç”¨ Helm éƒ¨ç½²
sh deploy/bin/helm/install.sh mingsha-template-vue-prod production values-prod.yaml

# 3. ç›‘æ§éƒ¨ç½²çŠ¶æ€
kubectl rollout status deployment/mingsha-template-vue-prod -n production
```

## ğŸ”§ é…ç½®è¯´æ˜

### JVM é…ç½® (conf/jvm.options)

```bash
# æœåŠ¡å™¨æ¨¡å¼
-server

# å†…å­˜é…ç½®
-Xms512m
-Xmx1024m
-Xmn256m

# å…ƒç©ºé—´é…ç½®
-XX:MetaspaceSize=64m
-XX:MaxMetaspaceSize=320m

# GC é…ç½®
-XX:+UseG1GC
-XX:MaxGCPauseMillis=200

# å…¶ä»–é…ç½®
-XX:-OmitStackTraceInFastThrow
-Dfile.encoding=UTF-8
```

### ç¯å¢ƒå˜é‡é…ç½®

```bash
# æ•°æ®åº“é…ç½®
DB_HOST=localhost
DB_PORT=3306
DB_NAME=mingsha_template_vue
DB_USERNAME=root
DB_PASSWORD=password

# Redis é…ç½®
REDIS_HOST=localhost
REDIS_PORT=6379
REDIS_PASSWORD=

# åº”ç”¨é…ç½®
SPRING_PROFILES_ACTIVE=prod
SERVER_PORT=8001
```

## ğŸš¨ æ³¨æ„äº‹é¡¹

1. **æƒé™è¦æ±‚**: ç¡®ä¿è„šæœ¬æœ‰æ‰§è¡Œæƒé™
   ```bash
   chmod +x deploy/bin/*/*.sh
   chmod +x deploy/deploy/*.sh
   ```

2. **ç¯å¢ƒä¾èµ–**: ç¡®ä¿å®‰è£…äº†å¿…è¦çš„å·¥å…·
   - Docker
   - kubectl
   - helm

3. **ç½‘ç»œé…ç½®**: ç¡®ä¿ç½‘ç»œè¿æ¥æ­£å¸¸
   - Docker ä»“åº“è®¿é—®
   - Kubernetes é›†ç¾¤è¿æ¥

4. **èµ„æºé™åˆ¶**: æ³¨æ„èµ„æºä½¿ç”¨æƒ…å†µ
   - ç£ç›˜ç©ºé—´
   - å†…å­˜ä½¿ç”¨
   - CPU ä½¿ç”¨

5. **å®‰å…¨è€ƒè™‘**: ç”Ÿäº§ç¯å¢ƒå®‰å…¨é…ç½®
   - é•œåƒç­¾åéªŒè¯
   - ç½‘ç»œå®‰å…¨ç­–ç•¥
   - è®¿é—®æ§åˆ¶

## ğŸ“ æŠ€æœ¯æ”¯æŒ

å¦‚é‡åˆ°éƒ¨ç½²é—®é¢˜ï¼Œè¯·æ£€æŸ¥ï¼š

1. **æ—¥å¿—æ–‡ä»¶**: æŸ¥çœ‹è¯¦ç»†é”™è¯¯ä¿¡æ¯
2. **é…ç½®éªŒè¯**: ç¡®è®¤é…ç½®æ–‡ä»¶æ­£ç¡®æ€§
3. **ç½‘ç»œè¿æ¥**: æ£€æŸ¥ç½‘ç»œè¿é€šæ€§
4. **èµ„æºçŠ¶æ€**: ç¡®è®¤èµ„æºå……è¶³

æ›´å¤šå¸®åŠ©è¯·å‚è€ƒï¼š
- [å¿«é€Ÿå¼€å§‹æŒ‡å—](å¿«é€Ÿå¼€å§‹.md)
- [éƒ¨ç½²æŒ‡å—](éƒ¨ç½²æŒ‡å—.md)
- [å¼€å‘æŒ‡å—](å¼€å‘æŒ‡å—.md) 